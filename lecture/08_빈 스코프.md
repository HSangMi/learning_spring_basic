## Bean Scope

### Bean Scope 란?
* 빈이 존재할 수 있는 범위 !
* SpringBean은 SpringContainer의 시작과 함께 생성되어, SpringContainer가 종료될 때 까지 유지 -> SpringBean이 기본적으로 싱글톤 스코프로 생성되기 때문

#### Spring은 다음과 같은 Scope을 지원
* **싱글톤** : 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프 
* **프로토타입** : 스프링 컨테이너는 프로토타입 빈의 생성 및 의존관계 주입까지만 관여하고 반환, => 종료메서드 호출 안됨. 짧은 범위의 스코프
* **웹 관련 스코프** : 웹 관련 기능을 사용할 때 지정할 수 있는 스코프
  * `request` : 웹 요청이 들어오고 나갈 때 까지 유지되는 스코프
  * `session` : 웹 세션이 생성되고 종료될 때 까지 유지되는 스코프
  * `application` : 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프

### Prototype Scope
* 싱글톤 스코프 빈을 조회하면, 스프링 컨테이너는 항상 같은 인스턴스의 스프링 빈을 반환하는 반면
* 프로토타입 스코프 빈을 조회하면, 스프링 컨테이너는 항상 새로운 인스턴스를 생성해서 반환

#### 프로토타입 스코프 지정 방법
* 컴포넌트 스캔 자동등록
```java
@Scope("prototype")
@Component
public class HelloBean(){}
```
* 수동 등록
```java
@Scope("prototype")
@Bean
PrototypeBean HelloBean(){
    return new HelloBean();
}
```

#### 프로토타입 스코프 빈 요청 시 동작
1. 클라이언트 : 프로토타입 스코프 빈을 스프링 컨테이너에 요청
2. 스프링 컨테이너 : 요청 시점에, 프로토타입 빈을 생성하고, 필요한 의존관계 주입
3. 스프링 컨테이너 : 생성한 프로토타입 빈을 클라이언트에 반환 후 더이상 관리x
4. 클라이언트 : 이후에 같은 요청을 하면 항상 새로운 프로토타입 빈을 생성해서 반환

#### 정리
> 핵심 : **스프링 컨테이너는 프로토타입 빈을 생성하고, 의존관계 주입, 초기화 까지만 처리**
> 스프링컨테이너에 요청할 때 마다 새로 성성됨
> 클라이언트에 빈을 반환 후 스프링 컨테이너는 생성된 프로토타입 빈을 관리하지 않음 
> 프로토타입 빈을 관리할 책임은 반환받은 클라이언트에 있음.
> `@PreDestroy`같은 종료메서드가 호출되지 않음
> 따라서, 프로토타입 빈은, 프로토타입 빈을 조회한 클라이언트가 관리해야한다. 종료 메서드에 대한 호출도 클라이언트가 직접 해야함

### 프로토타입 스코프, 싱클톤 빈과 함께 사용 시 문제점

스프링은 일반적으로 Singleton 빈을 사용하는데, Singleton 빈에서 Prototype 빈을 사용하는 경우
Singleton scope 빈이 등록되면서, DI가 일어나는데,
* 이 때 의존성주입을 시점에 스프링컨테이너에 Prototype Scope 빈의 생성요청을 함
* 싱글톤 빈이 이때 주입받은 PrototypeScope 빈을 계속 유지함
* => 이거는 Prototype Bean을 사용한 의도와 다르게 동작하는거다!!

